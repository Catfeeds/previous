<{assign var='tpl_title' value=L("找回密码")}>
<{include file="block/header.html" }>
    <div class="page page-current">
        <!--头部-->
        <header class="bar bar-nav"> <a class="button button-link button-nav pull-left back"> <span class="iconfont icon-iconfontxiangyou"></span> </a>
            <h1 class="title">找回密码</h1>
        </header>
        <!--头部结束-->
        <div class="content">
            <div class="login_tab_cont mt10">
                <div class="list_box">
                    <div class="list-block">
                        <ul>
                            <!-- Text inputs -->
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="text" id="mobile" placeholder="手机号">
                                        </div>
                                        <a href="javascript:;" class="yzmget">获取验证码</a>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="text" id="yzm" placeholder="验证码">
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="password" id="newpw" placeholder="新密码">
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="password" id="repw" placeholder="确认新密码">
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="txt_center font_size14 mt10 black9">密码长度至少6个字符，最多32个字符</div>
                    <div class="content-block"> <a class="button button-big button-fill button-success" id="reg">确定</a> </div>
                </div>
            </div>            
        </div>        
    <!--内容结束-->   
    </div>
<script>
$(document).ready(function() {
    $(".checkbox_xy").click(function(){
		if($(this).hasClass("on")){
			$(this).removeClass("on");
		}else{
			$(this).addClass("on");
		}
	});
});
</script>
<script>
var mobile_timeout;
var mobile_count = 60;
var mobile_lock = 0;
$(function(){
        $(function () {
            $(".yzmget").click(function () {
                if (mobile_lock == 0) {
                    mobile_count = 60;
					$(".yzmget").addClass("graybg");
                    $('.yzmget').attr("disabled", "disabled");
                    verify_pic();
                }

            });
        });
        BtnCount = function () {
            if (mobile_count == 0) {
				$(".yzmget").removeClass("graybg");
                $('.yzmget').removeAttr("disabled");
                $('.yzmget').text("重新获取");
                mobile_lock = 0;
                clearTimeout(mobile_timeout);
				$('.yzmget').removeClass("on");
            }
            else {
                mobile_count--;
                $('.yzmget').text( + mobile_count.toString() + "s重新获取");
                mobile_timeout = setTimeout(BtnCount, 1000);
				$('.yzmget').addClass("on");
            }
        };
		//注册页获取验证码部分结束
});

function verify_pic(){
	var modal = $.modal({
	    title: "<div class='txt_left'>请填写图形验证码</div>",
	    afterText:  "<div class='yzmint'><input type='text' id='pass-verify' value=''><span class='yzmimg'><img verify='#pass-verify' src="+"<{link ctl='magic:verify' http='ajax'}>&_=<{$pager.dateline}>"+" id='pass-verify'/></span></div>",
	    buttons: [
			{
				text: '取消'
			},
	      	{
	        	text: '确定',
	        	bold: true,
	        	onClick: function () {
	        		var verifycode = $("#pass-verify").val();
                    var mobile = $('#mobile').val();
	        		var link = "<{link ctl='passport/verify_img'}>";
	                 $.post(link,{verifycode:verifycode,mobile:mobile},function(ret){
	                	 if(ret.error){
	                        	$.alert(ret.message);
	                        }else{
	                        	send_sms();
	                        }
	               },'json');
		        }
	      	},
		]
  	})
}

function send_sms(){
	var mobile = $('#mobile').val(); 
	var link = "<{link ctl='passport/sendsms'}>";
	$.post(link,{mobile:mobile},function(ret){
		if(ret.error == 0){
	    	BtnCount();
			mobile_lock = 1;
			$(".get_yzm").addClass("on");
			$('.get_yzm').attr("disabled", "disabled");  
	    }else{
			$.alert(ret.message);
			mobile_lock = 0;
	    }
	},'json');
	mobile_count = minute;                    
}

$('#reg').click(function(){
    var mobile = $('#mobile').val(); 
    var yzm = $('#yzm').val();
    var newpw = $('#newpw').val();
    var repw = $('#repw').val();
    var link = "<{link ctl='passport/forgot' }>";
    $.post(link,{mobile:mobile,yzm:yzm,newpw:newpw,repw:repw},function(ret){
        if(ret.error == 0){
        	$.alert(ret.message);
            setTimeout(function(){
               window.location.href="<{link ctl='ucenter'}>";
            },2000)
            BtnCount();
        }else{
        	$.alert(ret.message);
            return ;
        }
        
    },'json');
})
</script>
<{include file="block/footer.html"}>