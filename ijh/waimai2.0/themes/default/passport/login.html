<{assign var='tpl_title' value=L("登陆")}>
<{include file="block/header.html" }>
    <div class="page page-current">
        <!--头部-->
        <header class="bar bar-nav"> <a class="button button-link button-nav pull-left back"> 
        	<span class="iconfont icon-iconfontxiangyou"></span> </a> 
        	<a class="button button-link button-nav pull-right" href="<{link ctl='passport/register'}>">注册</a>
            <h1 class="title">登录</h1>
        </header>
        <!--头部结束-->
        <div class="content">
            <div class="login_tab">
                <div class="list fl active">账号密码登录</div>
                <div class="list fl">手机号快捷登录</div>
            </div>
            <div class="login_tab_cont">
                <div class="list_box">
                    <div class="list-block">
                        <ul>
                            <!-- Text inputs -->
                            <li>
                                <div class="item-content">
                                    <div class="item-media"><i class="iconfont icon-wode"></i></div>
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="text" id="mobile" placeholder="昵称/手机号/邮箱" autocomplete="off">
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-media"><i class="iconfont icon-mima"></i></div>
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="password" id="password" placeholder="密码" class="" autocomplete="off">
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="content-block"> <a href="javascript:;" class="button button-big button-fill button-success" id="login1">登录</a> </div>
                    <div class="text-center font_size14"><a href="<{link ctl='passport/forgot'}>" class="maincl">忘记密码？</a></div>
                </div>
                <script>
                $('#login1').click(function(){
                    var mobile = $('#mobile').val(); 
                    var password = $('#password').val();
                    var link = "<{link ctl='passport/handle2' }>";
                    $.post(link,{mobile:mobile,password:password},function(ret){
                        if(ret.error == 0){
                        	$.alert(ret.message);
                            setTimeout(function(){
                               window.location.href='<{$url_login}>';
                            },1000)
                        }else{
                        	$.alert(ret.message)
                        }
                        
                    },'json');
                })
                </script>
                <div class="list_box" style="display:none;">
                    <div class="list-block">
                        <ul>
                            <!-- Text inputs -->
                            <li>
                                <div class="item-content">
                                    <div class="item-media"><i class="iconfont icon-shouji"></i></div>
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="text" id="mobile1" placeholder="手机号">
                                        </div>
                                        <a href="javascript:;" class="yzmget" id="yzmget" login="sendsms">获取验证码</a>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-media"><i class="iconfont icon-yanzhengma"></i></div>
                                    <div class="item-inner">
                                        <div class="item-input">
                                            <input type="text" id="yzm" placeholder="验证码">
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="content-block"> <a class="button button-big button-fill button-success open-slider-modal"  id="login2">登录</a> </div>
                </div>
                <script>
                $('#login2').click(function(){
                    var mobile = $('#mobile1').val(); 
                    var yzm = $('#yzm').val();
                    var yzm_val = $('#pass-verify').val();
                    var link = "<{link ctl='passport/handle' }>";
                    $.post(link,{mobile:mobile,yzm:yzm,yzm_val:yzm_val},function(ret){
                        if(ret.error == 0){
                        	$.alert(ret.message);
                            setTimeout(function(){
                               window.location.href='<{$url_login}>';
                            },1000)
                        }else{
                        	$.alert(ret.message)
                        }
                        
                    },'json');
                })
                </script>
                <style>
                .login_bot{ margin:1.5rem 0;}
                .login_bot h2{ text-align:center; border-bottom:0.05rem solid #ddd; height:1rem; margin:0 auto 1.25rem; font-weight:normal;}
                .login_bot span{ font-size:0.7rem; display:inline-block; background:#fafafa; padding:0 1rejavascript:;; line-height:2rem;}
                .login_other{ margin:0 0.75rem; text-align:center;}
                .login_other a{ display:inline-block; margin:0 0.5rem;}
                .login_other a p{ font-size:0.7rem; line-height:1.2rem; color:#333;}
                .login_other a img{ display:inline-block; width:2.2rem; height:2.2rem;}
                </style>
                <div class="login_bot pd10">
                    <h2><span class="black9">第三帐号方登录</span></h2>
                    <div class="login_other">
                        <a href="<{link ctl='passport/wxlogin'}>" class="external"><img src="%THEME%/static/images/loginWay.png"><p>微信</p></a>
                    </div>
                </div>
            </div>            
        </div>        
    <!--内容结束-->   
    </div>
<script>
$(document).ready(function() {
    $(".login_tab .list").each(function(i){
		$(this).click(function(){
			$(".login_tab .list").removeClass("active");
			$(this).addClass("active");
			$(".login_tab_cont .list_box").each(function(e){
				if(i==e){
					$(".login_tab_cont .list_box").hide();
					$(this).show();
				}else{
					$(this).hide();
				}
			});
		});
	});
});
</script> 
<script>

//url referer
localStorage['url_login']='<{$url_login}>';

var mobile_timeout;
var mobile_count = 60;
var mobile_lock = 0;

$(function(){
        $(function () {
            $("#yzmget").click(function () {
                if (mobile_lock == 0) {
                    mobile_count = 60;
					$("#yzmget").addClass("graybg");
                    $('#yzmget').attr("disabled", "disabled");
                    verify_pic();
                }
            });
        });
        BtnCount = function () {
            if (mobile_count == 0) {
				$("#yzmget").removeClass("graybg");
                $('#yzmget').removeAttr("disabled");
                $('#yzmget').text("重新获取");
                mobile_lock = 0;
                clearTimeout(mobile_timeout);
				$('#yzmget').removeClass("on");
            }
            else {
                mobile_count--;
                $('#yzmget').text( + mobile_count.toString() + "s重新获取");
                mobile_timeout = setTimeout(BtnCount, 1000);
				$('#yzmget').addClass("on");
            }
        };
		//注册页获取验证码部分结束
		
});

function verify_pic(){
	var modal = $.modal({
	    title: "<div class='txt_left'>请填写图形验证码</div>",
	    afterText:  "<div class='yzmint'><input type='text' id='pass-verify' value=''><span class='yzmimg'><img verify='#pass-verify' src="+"<{link ctl='magic:verify' http='ajax'}>&_=<{$pager.dateline}>"+" id='pass-verify'/></span></div>",
	    buttons: [
			{
				text: '取消'
			},
	      	{
	        	text: '确定',
	        	bold: true,
	        	onClick: function () {
	        		var verifycode = $("#pass-verify").val();
                    var mobile = $('#mobile1').val();
	        		var link = "<{link ctl='passport/verify_img'}>";
	                 $.post(link,{verifycode:verifycode,mobile:mobile},function(ret){
	                	 if(ret.error){
	                        	$.alert(ret.message);
	                        }else{
	                        	send_sms();
	                        }
	               },'json');
		        }
	      	},
		]
  	})
}

function send_sms(){
	var mobile = $('#mobile1').val(); 
	var link = "<{link ctl='passport/sendsms'}>";
	$.post(link,{mobile:mobile},function(ret){
		if(ret.error == 0){
	    	BtnCount();
			mobile_lock = 1;
			$(".get_yzm").addClass("on");
			$('.get_yzm').attr("disabled", "disabled");  
	    }else{
			$.alert(ret.message);
			mobile_lock = 0;
	    }
	},'json');
}
</script>
<{include file="block/footer.html"}>