<{assign var='tpl_title' value=L("账户信息")}>
<{include file="block/header.html" }>
<script src="%THEME%/static/js/jquery.js"></script>
<script>jQuery.noConflict()</script>
<script type="text/javascript" src="<{$pager.res}>/kindeditor/kindeditor.js"></script>
    <div class="page page-current"> 
    	<!--头部-->
        <header class="bar bar-nav"> 
        	<a class="button button-link button-nav pull-left" id="back"> 
        		<span class="iconfont icon-iconfontxiangyou"></span> 
        	</a>
            <h1 class="title">账户信息</h1>
        </header>
        <!--头部结束-->
        <div class="content">
           <div class="mineAcntinfor mt10">
           		<div class="list-block">
                    <ul>
                    <style type="text/css">
						.ke-upload-file {width:100% !important}
						.ke-button{display:none;}
						.Acnt_hdImg{ position:relative;}
						.ke-upload-file{position: absolute; left:0; top: 0; width:100%; height: 100%; opacity: 0;}
					</style>
                      <li class="item-content item-link Acnt_hdImg">
                        <div class="item-inner">
                          <div class="item-title">头像</div>
                          <div class="item-after img">
                          	<img class="face_img" src="<{$pager.img}>/<{$MEMBER.face}>">
                          </div>
                        </div>
                        <input type="button" uploadbtn="#file_photo" id="face_img" class="imgs" value="头像"/>
                      </li>
                      <li>
                      	<a href="<{link ctl='ucenter/info/update_nickname'}>" class="item-content item-link">
                        	<div class="item-inner">
                          		<div class="item-title"><{$MEMBER.nickname}></div>
                          		<div class="item-after">修改</div>
                        	</div>
                        </a>
                      </li>
                    </ul>
                  </div>
                  <div class="mt10"></div>
                  <div class="list-block">
                    <ul>
                      <li>
                      	<a href="<{link ctl='ucenter/info/update_mobile'}>" class="item-content item-link">
                        	<div class="item-inner">
                          		<div class="item-title">手机号</div>
                          		<div class="item-after">
                          			<{substr_replace($MEMBER.mobile,'****',3,4)}>
                          		</div>
                        	</div>
                        </a>
                      </li>
                      <li class="item-content item-link" id="wxbind">
						<div class="item-inner">
                        	<div class="item-title">微信</div>
                          	<div class="item-after">
                          	<{if !empty($MEMBER.wx_openid)}>
                          		<a href="javascript:;" class="maincl">已绑定</a>
                          	<{else}>
                          		<a href="javascript:;" class="maincl">未绑定</a>
                          	<{/if}>
                          	</div>
                        </div>
                      </li>
                      <li>
                      	<a href="<{link ctl='ucenter/info/update_passwd'}>" class="item-content item-link">
                        <div class="item-inner">
                          <div class="item-title">修改密码</div>
                        </div>
                      	</a>
                      </li>
                    </ul>
                  </div>
           </div>
           	<form id='faceform' name='faceform' action="<{link ctl='ucenter/info:upload_face'}>" method='post' enctype='multipart/form-data' hidden>
    			<input id="face" class='face' type='file' name='face' onChange="fileSumbit(this)"/>从相册选择
    			<input id="subbtn" value='sub' type='submit'>submit
    		</form> 
        </div>        
    <!--内容结束-->   
    </div>
    
<<script type="text/javascript" >
$(".create-actions").click(function(){
	var buttons1 = [
    {
		text: "<div class='mineAcntinfor_btn black3'>拍照</div>",
		onClick: function() {
		  
		}
    },
    {
      text: "<div class='mineAcntinfor_btn black3'>从相册选择</div>",
      onClick: function() {
      	$(".face").click();
      }
    }
  	];
  	var buttons2 = [
    {
      text: "<div class='mineAcntinfor_btn black9'>取消</div>",
    }
  	];
  	var groups = [buttons1, buttons2];
  	$.actions(groups);
});
	
function fileSumbit(obj){
	var files = obj.files;
	if(files){
		for(var i=0;i<files.length;i++){
            var tag = '';
            var rFilter = /^(image\/gif|image\/jpeg|image\/jpg|image\/png)$/i;
	        if (! rFilter.test(files[i].type)) {                   
	            $.alert("<{L('只允许上传')}>JPG、PNG、JPEG<{L('格式图片')}>");
	            return false;
	        }
	    }
		$('#subbtn').click();
	}
}
	
	
function fileSelected(obj){
    var files = obj.files;
    for(var i=0;i<files.length;i++){
        var tag = '';
        var rFilter = /^(image\/gif|image\/jpeg|image\/jpg|image\/png)$/i;
        if (! rFilter.test(files[i].type)) {                   
            alert("<{L('只允许上传')}>JPG、PNG、GIF<{L('格式图片')}>");
            return false;
        }
        var reader = new FileReader();
        reader.onloadstart = function(e){
                $(".loading").show();
        }
        reader.onload = function(e){
            $(".face_img").attr('src',e.target.result);
            var img = e.target.result;
            $.post("<{link ctl='ucenter/info:uploadface'}>",{img:img},function(ret){
            	$.alert(ret.message);         	
            },'json');
            
        }
        reader.readAsDataURL(files[i]);
    }
}
	
$(document).off('click','#wxbind').on('click','#wxbind',function(){
    var wx_openid = "<{$MEMBER.wx_openid}>";
    if(wx_openid != "") {
        $.confirm('您确定要解除微信绑定吗?', '温馨提示',function(){
            $.ajax({  
                url: "<{link ctl='ucenter/info:wx_bind'}>",
                async: true,  
                dataType: 'json',  
                type: 'POST',   
                success: function (ret) { 
                    $.alert(ret.message);
                    setTimeout(function(){
                        window.location.reload();
                    },2000);
                }, 
                error: function (XMLHttpRequest, textStatus, errorThrown) { 
                    alert(errorThrown); 
                },    
            });
        },function(){});
    }else {
        $.ajax({  
            url: "<{link ctl='ucenter/info:wx_bind'}>",
            async: true,  
            dataType: 'json',  
            type: 'POST',   
            success: function (ret) { 
                $.alert(ret.message);
                setTimeout(function(){
                    window.location.reload();
                },2000);
            }, 
            error: function (XMLHttpRequest, textStatus, errorThrown) { 
                alert(errorThrown); 
            },    
            
        });
    }

});
	
$('#back').click(function(){
	$.router.load("<{link ctl='ucenter/index'}>", true);
});

(function(K, $){
KindEditor.ready(function(KE) {
    $("[uploadbtn]").each(function(){
    	 var flag = $(this).attr('id');
         var upload_url = $(this).attr("uploadbtn")
         var uploadbutton = KE.uploadbutton({
            button : $(this)[0],
            fieldName : 'imgFile',
            url : '<{link ctl="ucenter/info:photo" http="ajax"}>',
            afterUpload : function(data) {
                if (data.error === 0) {
                	window.location.href="<{link ctl='ucenter/info'}>";
                } else {
                    $.alert(data.message);
                }
            },
            afterError : function(str) {
                alert(str);
            }
        });
        uploadbutton.fileBox.change(function(e) {
            uploadbutton.submit();
        });           
    });
});
})(window.KT, window.jQuery);

</script>
<{include file="block/footer.html"}>