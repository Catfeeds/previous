<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Baidu Maps Marker By IJH.CC</title>
		<style>
			html { height: 100%;overflow:hidden;}
			body { height: 100%; margin: 0; padding: 0; background-color: #FFF;font-size: 11px;}
			.button{-webkit-box-shadow: none;-moz-box-shadow: none;box-shadow: none;background-color: #4d90fe;background-image: -webkit-linear-gradient(top,#4d90fe,#4787ed);background-image: -moz-linear-gradient(top,#4d90fe,#4787ed);background-image: -ms-linear-gradient(top,#4d90fe,#4787ed);background-image: -o-linear-gradient(top,#4d90fe,#4787ed);background-image: linear-gradient(top,#4d90fe,#4787ed);border: 1px solid #3079ed;color: #fff;-webkit-border-radius: 2px;-moz-border-radius: 2px;border-radius: 2px;cursor: default;font-weight: bold;text-align: center;white-space: nowrap; margin-right: 16px; height: 27px; line-height: 25px; min-width: 54px; outline: 0px; padding: 0 8px;}
		</style>
		<!--<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=824a595f958e444b737a5bc6325ad44f"></script>-->
	   <body onload="initialize();">
        <script type="text/javascript"  src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>


		
	</head>
		<div style="padding:3px 8px;border-bottom:1px solid #dedede;">
			<label style="display:inline-block;">
				<input type="text" value="" id="Baidu_Map_SO_Key" style="width:150px;height:21px;padding:3px 5px;border:1px solid #CCC;"/>&nbsp;&nbsp;
				<button id="Baidu_Map_SO_Btn" class="button" onclick="search(document.getElementById('Baidu_Map_SO_Key').value)">定位</button>
			</label>
			<label style="float:right;line-height:21px;padding:3px 5px;display:inline-block;"><b>坐标</b>：<input type="text" value="" id="Baidu_Map_Marker" style="width:150px;height:21px;padding:3px 5px;border:1px solid #CCC;"  readonly/></label>
			<div style="clear:both;"></div>
		</div>
		<div id="map_canvas" style="width:100%; height:96%"></div>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpffjC9Wbc5sT8B2KBg6bx1382rjo7QbY&signed_in=true&language=it&libraries=places" async defer></script>
		<script type="text/javascript" >
            var map, geocoder, service, marker;
			var P = {};
            var G = parent.window.G || {};
            var container = document.getElementById("map_canvas");

            function GetQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            }

            function initialize() {
                map = new google.maps.Map(container);
			    service = new google.maps.places.PlacesService(map);  
                P.lng = GetQueryString("lng") || '';
				P.lat = GetQueryString("lat") || '';
                if(P.lng && P.lat){
				    document.getElementById("Baidu_Map_Marker").value = P.lng + ", " + P.lat;
                    map.setZoom(15);
                    map.setCenter(new google.maps.LatLng(P.lat, P.lng));
                }else{
                    map.setZoom(15);
                    map.setCenter(new google.maps.LatLng(41.902481, 12.535685999999941));
                }
                marker = new google.maps.Marker({
			        map: map,
                    position: new google.maps.LatLng(P.lat, P.lng),
			        animation: google.maps.Animation.DROP,
			    });
			    marker.setDraggable(true);
			    marker.addListener("drag",function(e){
			    	SetMapPoint(e.latLng);
			    });
			    map.setOptions({'disableDoubleClickZoom':true});
			    map.addListener('dblclick', function(e){
					marker.setPosition(e.latLng);
					SetMapPoint(e.latLng);
				});
            }

            function SetMapPoint(point){
				P = point;
				document.getElementById("Baidu_Map_Marker").value =  P.lng() + ", " + P.lat();				
			}

			function search(address) {
				if (!map) return;
				if(!address){
					alert("请输入有效的定位地点");return false;
					return ;
				}
                service.textSearch({query:address}, function(result, status, pagination) {
                    if (status == google.maps.places.PlacesServiceStatus.OK) {
                    	var place = result[0];
                        var bounds = new google.maps.LatLngBounds();
                        if (place.geometry.viewport) {
				            bounds.union(place.geometry.viewport);
				        }else {
				            bounds.extend(place.geometry.location);
				        }
				        var point = {
				        	lat:place.geometry.location.lat(),
				        	lng:place.geometry.location.lng()
				        };
				        map.fitBounds(bounds);
				        map.setZoom(15);
                        map.setCenter(point);
                    }
                });
            }
		</script>
	</body>
</html>