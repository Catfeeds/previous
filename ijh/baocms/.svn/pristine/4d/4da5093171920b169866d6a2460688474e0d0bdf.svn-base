<!DOCTYPE html>
<html>
    <head>
        <title>优惠券</title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../css/reset.css"/>
        <link rel="stylesheet" type="text/css" href="../css/css_1.css"/>
        <script src="../js/appcan.js"></script>
        <script src="../js/appcan.control.js"></script>
        <script src="../js/application.js"></script>
        <script src="../js/application.init.js"></script>
    </head>
<body>
	<div id="ele" class="page-center-box">
        <div id="scroll">
            <!-- 广告 -->
            <div class="ads">
                <script src="../js/jquery-1.7.1.min.js" type="text/javascript"></script>
                <script src="../js/jquery.event.drag-1.5.min.js" type="text/javascript"></script>
                <script type="text/javascript" src="../js/jquery.touchSlider.js"></script>
                
                <!-- templates -->
                <script id="cates" type="text/template">
                    <li><a onclick="jumpto('%cate_id%','1')">
                            <span class="mydate-yuan favou-lei0%i%"><img src="../img/icn0%i%.png"></span>
                            <p>%cate_name%</p>
                        </a>
                    </li>
                </script>
                
                
                
                
                <script id="hots" type="text/template">
                  <div class="favou-content">
                        <div  class="favou-img left">
                            <a href="" onclick="jumpto('%coupon_id%','0')">
                                <img src="%photo%" />
                            </a>
                        </div>
                        <div class="favou-zi left">
                            <a onclick="jumpto('%coupon_id%','0')" href="">
                                <p class="overflow_clear">%shop_name%</p>
                                <p class="c_h h15 overflow_clear">%title%</p>
                                <p class="c_h h15">有效期至：%expire_date%</p>
                                <p class="favou-zai">
                                    <span class="price left">%downloads%人已下载</span>
                                    <span class="sell right">距离:%d%</span>
                                    <div class="clear"></div>
                                </p>
                            </a>
                        </div>
                        <div class="clear"></div>
                    </div>
                </script>
                
                <script id="ads" type="text/template">
                    <li>
                        a href="%link_url%" title="%title%">
                        <img src="%photo%" width="" height="100%">
                        </a>
                    </li>
                </script>
                
                
                <script type="text/javascript">
               
                    $(document).ready(function(){
                    
                        $(".main_image").touchSlider({
                            flexible : true,
                            speed : 200,
                            btn_prev : $("#btn_prev"),
                            btn_next : $("#btn_next"),
                            paging : $(".flicking_con a"),
                            counter : function (e){
                                $(".flicking_con a").removeClass("on").eq(e.current-1).addClass("on");
                            }
                        });
                        
                        
                        
                        $(".main_image").bind("mousedown", function() {
                            $dragBln = false;
                        });
                        
                        $(".main_image").bind("dragstart", function() {
                            $dragBln = true;
                        });
                        
                        $(".main_image a").click(function(){
                            if($dragBln) {
                                return false;
                            }
                        });
                        
                        timer = setInterval(function(){
                            $("#btn_next").click();
                        }, 5000);
                        
                        $(".ele_banner").hover(function(){
                            clearInterval(timer);
                        },function(){
                            timer = setInterval(function(){
                                $("#btn_next").click();
                            },5000);
                        });
                        
                        $(".main_image").bind("touchstart",function(){
                            clearInterval(timer);
                        }).bind("touchend", function(){
                            timer = setInterval(function(){
                                $("#btn_next").click();
                            }, 5000);
                        });
                        
                    });
                    
                    //加载LOADING数据
                    window.readCache = function(key){
                        key = key || KEY.COUPON_MAIN;
                     //读取缓存
                        var cached = baoapp.helper.cacheExpireRead(key);
                            cached = JSON.parse(cached);
                        var data     = [];
                        var http_url = baoapp.config.attachs;
                        /*
                        var shopcates = baoapp.config.shopcates;
                        var count = 0 ;
                        //shopcate
                        data.cates = [];
                        for(var i in shopcates){
                            if(count==7){
                                data.cates[++i] = {cate_id:0,i:8,cate_name:'更多'};
                                break;
                            }
                            if(shopcates[i]['parent_id'] != 0){
                                   continue;
                            }
                            count++;
                            data.cates[i] = {cate_id:shopcates[i].cate_id,i:count,cate_name:shopcates[i].cate_name};
                        }
                        */
                        
                        var list = cached.list;
                        var shops = cached.shops;
                        data.hots = [];
                        for(var i in list){
                            var photo = http_url+list[i].photo;
                            data.hots[i] = {coupon_id:list[i].coupon_id,shop_name:shops[list[i].shop_id].shop_name,title:list[i].title,expire_date:list[i].expire_date,photo:photo,downloads:list[i].downloads,d:shops[list[i].shop_id].d};
                        }
                        
                        var ads = cached.ad;
                        data.ads = [];
                        for(var i in ads){
                            var photo = http_url + ads[i].photo;
                            data.ads[i] = {link_url:ads[i].link_url,title:ads[i].title,photo:photo};
                            //TODO
                        }
                        renderList(data);
                    }
                    
                    
                    function renderList(cached,reload){
                        reload = reload || false;
                        if(reload){
                            document.querySelector('.send-out').innerHTML = '';
                        }
                        for(tplid in cached) 
                         for(i in cached[tplid])
                            createNode(tplid,cached[tplid][i]);
                            
                            
                        
                    }
                    
                    function createNode(tplid,data)
                    {      
                        with(document){
                            var spanNode = createElement('span'),
                            tmpl     = getElementById(tplid).innerHTML;
                           
                            for(key in data){
                               tmpl = tmpl.replace(eval("/%"+key+"%/g"),data[key]); 
                            }
                            getElementById(tplid+'_content').innerHTML +=tmpl;
                        }
                    }
                    
                    
                    function jumpto(id,key)
                    {
                        id = id || 0;
                        var data = '';
                        with(baoapp.helper){
                            switch(key){
                                case '0':
                                    linkTo(KEY.COUPON_DETAIL,'detail.html','coupon_id-'+id,5);
                                break;
                                case '1':
                                    linkTo(KEY.COUPON_INDEX,'index.html','cat_id-'+id,5);
                                break;
                            } 
                        };
                    }
                </script>
                
                <script>
                     appcan.ready(
                        function(){
                           var key = KEY.COUPON_MAIN;
                           
                           with(baoapp.helper){
                             try {
                               var url = createUrl('coupon','main'); 
                               var cached = cacheExpireRead(key);
                               var shopcates = baoapp.config.shopcates;
                               var htm = '<ul>';
                               var count = 0;
                               for(var i in shopcates){
                                   if(count==7){
                                       break;
                                   }
                                   if(shopcates[i]['parent_id'] != 0){
                                       continue;
                                   }
                                   count++;
                                   htm += '<li><a onclick="jumpto(\''+shopcates[i].cate_id+'\',\'1\')">';
                                   //TODO 1
                                   htm += '<span class="mydate-yuan favou-lei0' + count + '"><img src="../img/icn0'+count+'.png"></span>';
                                   htm += '<p>'+shopcates[i].cate_name+'</p>';
                                   htm += '</a></li>';
                               }
                               htm += '<li><a onclick="baoapp.helper.linkTo(\'index\',\'index.html\');">';
                               htm += '<span class="mydate-yuan favou-lei08"><img src="../img/icn08.png"></span>';
                               htm += '<p>更多</p></a></li>';
                               htm += '</ul>';
                               $('#coupon_cates').html(htm);
                               
                               
                               if(!cached){
                                     ayscLoad(url,null,'GET','json',function(data){
                                        if(CONST.BAO_REQUEST_SUCCESS == data.status){
                                             //抓取数据写入缓存
                                            cacheExpireWrite(key,JSON.stringify(data));
                                            window.readCache(key);
                                        }
                                    });
                               }else{
                                   window.readCache(key);
                               }
                             }catch(e){
                                 console.log(e);
                                 resourceError();
                             }
                           }
                           
                        }
                    )
                    
                </script>
                <div class="ele_banner">
                    <div class="flicking_con">
                        <a href="#"></a>
                    </div>
                    <div id="ads_content" class="main_image">
                    </div>
                    <a href="javascript:;" id="btn_prev"></a>
                    <a href="javascript:;" id="btn_next"></a>
                </div>
            </div>
            <!-- TODO -->
            
            <!-- 分类 -->
            <div id="coupon_cates" class="mydate-style favou-style">
                     <!--
                    <li><a onclick="baoapp.helper.linkTo('index','index.html','cat_id-1')">
                            <span class="mydate-yuan favou-lei01"><img src="../img/icn01.png"></span>
                            <p>餐饮美食</p>
                        </a>
                    </li>
                    <li><a onclick="baoapp.helper.linkTo('index','index.html','cat_id-2')">
                            <span class="mydate-yuan favou-lei02"><img src="../img/icn02.png"></span>
                            <p>旅游</p>
                        </a>
                    </li>
                    <li><a onclick="baoapp.helper.linkTo('index','index.html','cat_id-3')">
                            <span class="mydate-yuan favou-lei03"><img src="../img/icn03.png"></span>
                            <p>休闲娱乐</p>
                        </a>
                    </li>
                    <li><a onclick="baoapp.helper.linkTo('index','index.html','cat_id-4')">
                            <span class="mydate-yuan favou-lei04"><img src="../img/icn04.png"></span>
                            <p>酒店</p>
                        </a>
                    </li>
                    <li><a onclick="baoapp.helper.linkTo('index','index.html','cat_id-5')">
                            <span class="mydate-yuan favou-lei05"><img src="../img/icn05.png"></span>
                            <p>结婚</p>
                        </a>
                    </li>
                    <li><a onclick="baoapp.helper.linkTo('index','index.html','cat_id-6')">
                            <span class="mydate-yuan favou-lei06"><img src="../img/icn06.png"></span>
                            <p>母婴</p>
                        </a>
                    </li>
                    <li><a onclick="baoapp.helper.linkTo('index','index.html','cat_id-7')">
                            <span class="mydate-yuan favou-lei07"><img src="../img/icn07.png"></span>
                            <p>家居</p>
                        </a>
                    </li>
                    <li><a onclick="baoapp.helper.linkTo('index','index.html');">
                        <span class="mydate-yuan favou-lei08"><img src="../img/icn08.png"></span>
                        <p>更多</p>
                        </a>
                    </li>
                -->
                    
            </div>
            <!-- 列表 -->
            <div class="list-have-pic" id="mall-main">
                <div class="list-box">
                    <div class="favou-hot">热门推荐</div>
                    <!-- 循环 -->
                    <div id="hots_content">
                    <!--
                    <div class="favou-content">
                        <div class="favou-img left">
                            <a href="">
                                <img src="../img/icn09.png" />
                            </a>
                        </div>
                        <div class="favou-zi left">
                            <a href="">
                                <p class="overflow_clear">宽大摄影</p>
                                <p class="c_h h15 overflow_clear">仅售299...</p>
                                <p class="c_h h15">有效期至：2015-10-10</p>
                                <p class="favou-zai">
                                    <span class="price left">13人已下载</span>
                                    <span class="sell right">距离:7.23km</span>
                                    <div class="clear"></div>
                                </p>
                            </a>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="favou-content">
                        <div class="favou-img left">
                            <a href="">
                                <img src="../img/icn09.png" />
                            </a>
                        </div>
                        <div class="favou-zi left">
                            <a href="">
                                <p class="overflow_clear">宽大摄影</p>
                                <p class="c_h h15 overflow_clear">仅售299...</p>
                                <p class="c_h h15">有效期至：2015-10-10</p>
                                <p class="favou-zai">
                                    <span class="price left">13人已下载</span>
                                    <span class="sell right">距离:7.23km</span>
                                    <div class="clear"></div>
                                </p>
                            </a>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="favou-content">
                        <div class="favou-img left">
                            <a href="">
                                <img src="../img/icn09.png" />
                            </a>
                        </div>
                        <div class="favou-zi left">
                            <a href="">
                                <p class="overflow_clear">宽大摄影</p>
                                <p class="c_h h15 overflow_clear">仅售299...</p>
                                <p class="c_h h15">有效期至：2015-10-10</p>
                                <p class="favou-zai">
                                    <span class="price left">13人已下载</span>
                                    <span class="sell right">距离:7.23km</span>
                                    <div class="clear"></div>
                                </p>
                            </a>
                        </div>
                        <div class="clear"></div>
                    </div>
                    -->
                    </div>
                <!-- 循环 -->
            </div>
        </div>
        
        
    </div>
</body>


</html>
