<{include file="merchant:block/header.html"}>

<div class="row">

    <div class="col-sm-12">
        <div class="tabs-container">
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true"> 拼团商品</a></li>
                <li class="list_btn_right">
                    <button onclick="location_addr('<{link ctl='merchant/weidian/pintuanproduct:create'}>')"
                            class="btn btn-primary ">添加拼团
                    </button>
                </li>
                <li class="list_btn_right">
                    <button href="<{link ctl="merchant/weidian/pintuanproduct/so"}>" mini-load="搜索内容" mini-width="500" class="btn btn-danger " title="搜索">搜索</button>
                </li>

            </ul>

            <div class="tab-content">

                <div id="tab-1" class="tab-pane active">
                    <div class="panel-body">
                        <table class="table table-striped table-hover" id="myTable">
                            <thead>
                            <tr>
                                <th>商品ID</th>
                                <th>分类</th>
                                <th>图片</th>
                                <th>标题</th>
                                <th>团购价</th>
                                <th>团类型</th>
                                <th>团购信息</th>
                                <th>是否在售</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <{foreach $items as $item}>
                            <tr>
                                <td><label><input type="checkbox" value="<{$item.product_id}>" id="product_id"
                                                  class="product_id" name="product_id[]"
                                                  CK="PRI"/><{$item.product_id}><label></td>
                                <td><{$cates[$item['cate_id']]}></td>
                                <td><img src="<{$pager.img}>/<{$item.photo}>" width="70"/></td>
                                <td>
                                    <{$item.title}><br/>
                                    <!--总销量:<{$item.sales}><br/>-->
                                    佣金:<{$item.product.money_master}>
                                    <!--预付款:<{$item.money_pre}>-->
                                </td>
                                <td>
                                    团购价: &yen;<{$item.wei_price}><br/>
                                    单买价: &yen;<{$item.price}><br/>
                                </td>
                                <td>
                                    <{if 1 == $item['product']['tuan_type']}>阶梯团
                                    <{if $item.level}>
                                    <hr/>
                                    <{foreach $item.level as $v}>
                                    <{$v.user_num}>人团：&yen;<{$v.price}><br/>
                                    <{/foreach}>
                                    <{/if}>

                                    <{else}>普通团,<{$item.product.user_num}>人团<{/if}>

                                </td>
                                <td>
                                    满员限购: <{if 1==$item.product.tuan_limit}>是<{else}>否<{/if}><br/>
                                    购买开团: <{if 1==$item.product.master_need_buy}>是<{else}>否<{/if}><br/>
                                    单人购买上限: <{$item.product.item_limit}>件<br/>
                                    成团有效期: <{$item.product.tuan_time}>天<br/>
                                </td>
                                <td><{if $item.is_onsale == 1}><font style="color:green;">上架中</font><{else}><font
                                        style="color:red;">已下架</font><{/if}>
                                </td>
                                <td>
                                    <{if $item.is_onsale == 1}><a
                                        href="<{link ctl='merchant/weidian/product:open' args=$item.product_id}>"
                                        mini-act="open" mini-confirm="确定要下架吗？" title="下架" class="btn btn-success btn-sm btn-outline">下架</a>
                                    <{else}><a
                                        href="<{link ctl='merchant/weidian/product:open' args=$item.product_id}>"
                                        mini-act="closed" mini-confirm="确定要上架吗？" title="上架"
                                        class="btn btn-warning btn-sm btn-outline">上架</a><{/if}>
                                    <a href="<{link ctl='merchant/weidian/pintuanproduct/edit' args=$item.product_id}>"
                                       class="btn btn-primary btn-sm btn-outline"><{L('修改')}></a>&nbsp;&nbsp;
                                    <a href="<{link ctl='merchant/weidian/product/delete' args=$item.product_id}>"
                                       mini-act="confirm:<{L('确认要删除该商品吗')}>?" class="btn btn-danger btn-sm btn-outline"><{L('删除')}></a>
                                </td>
                            </tr>
                            <{foreachelse}>
                            <tr>
                                <td colspan="20">
                                    <div class="alert alert-info"><{L('没有数据')}></div>
                                </td>
                            </tr>
                            <{/foreach}>
                            </tbody>
                        </table>

                        <!--分页-->
                        <div class="clearfix p-xs">
                            <div class="pull-left">
                                <span class="m-r-sm"><input type="checkbox" class="i-checks" id="allChk"></span>
                                <a href="javascript:delModal(0);">
                                    <button type="button" class="btn btn-primary" id="add_stock">批量上架</button>
                                </a>
                                <a href="javascript:delModal(1);">
                                    <button type="button" class="btn btn-primary" id="des_stock">批量下架</button>
                                </a>
                            </div>

                            <div class="btn-group pull-right pagination_box">
                                <div class="page"><{$pager.pagebar}></div>
                            </div>
                        </div>
                        <!--分页结束-->
                    </div>


                </div>
            </div>

        </div>
    </div>


</div>


<{include file="merchant:block/footer.html"}>

<script>
    // 全选  
    $("#allChk").click(function () {
        $("input[name='product_id[]']").prop("checked", this.checked);
    });

    // 单选  
    var subChk = $("input[name='product_id[]']")
    subChk.click(function () {
        $("#allChk").prop("checked", subChk.length == subChk.filter(":checked").length ? true : false);
    });

    /* 批量上架 */
    function add_stock() {
        var checkedNum = $("input[name='product_id[]']:checked").length;
        if (checkedNum == 0) {
            layer.msg("请选择至少一项！");
            //alert("请选择至少一项！");  
            return;
        }

        // 批量选择   
        if (true) {
            var checkedList = new Array();
            $("input[name='product_id[]']:checked").each(function () {
                checkedList.push($(this).val());
            });
            //console.log(checkedList);
            $.ajax({
                type: "POST",
                url: "?weidian/product/onsale_openall",
                data: {'product_id': checkedList},
                success: function (ret) {
                    //alert(typeof(ret));
                    var ret = jQuery.parseJSON(ret);
                    if (ret.error == 0) {
                        layer.msg(ret.message);
                    } else {
                        layer.msg(ret.message);
                    }
                    window.location.reload();
                }
            });
        }
    }

    //批量下架
    function des_stock() {
        /*$("#des_stock").click(function() { */
        // 判断是否至少选择一项  
        var checkedNum = $("input[name='product_id[]']:checked").length;
        if (checkedNum == 0) {
            layer.msg("请选择至少一项！");
            //alert("请选择至少一项！");
            return;
        }

        // 批量选择
        if (true) {
            var checkedList = new Array();
            $("input[name='product_id[]']:checked").each(function () {
                checkedList.push($(this).val());
            });
            //console.log(checkedList);
            $.ajax({
                type: "POST",
                url: "?weidian/product/onsale_close",
                data: {'product_id': checkedList},
                success: function (ret) {
                    //alert(typeof(ret));
                    var ret = jQuery.parseJSON(ret);
                    if (ret.error == 0) {
                        layer.msg(ret.message);
                    } else {
                        layer.msg(ret.message);
                    }
                    window.location.reload();
                }
            });
        }
    }
</script>
<script>
    function delModal(num) {
        swal({
            title: "确定吗?",
            text: "",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "确定",
            cancelButtonText: "取消",
            closeOnConfirm: true, //点击了确认按钮后模态窗口自动关闭
        }, function (isConfirm) {
            if (isConfirm) {
                if (num == 0) {
                    add_stock();
                } else {
                    des_stock();
                }
            } else {
                swal("Cancelled", "Your imaginary file is safe :)", "error");
            }
        });
    }
</script>  