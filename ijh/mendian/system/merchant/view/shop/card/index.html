<{include file="merchant:block/header.html"}>
<div class="row">
    <div class="col-sm-12">
        <div class="tabs-container">
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="<{link ctl='merchant/shop/card:index'}>" aria-expanded="true">会员列表</a></li>
                <li class="list_btn_right">
                    <botton onclick="location_addr('<{link ctl='merchant/shop/card:create'}>')" class="btn btn-primary ">添加会员</botton>
                </li>
                <li class="list_btn_right">
                    <button href="<{link ctl='merchant/shop/card/so'}>" mini-load="搜索内容" mini-width="500" class="btn btn-danger " title="搜索">搜索</button>
                </li>
            </ul>
            <div class="tab-content" style="texaligent">
                <div id="tab-1" class="tab-pane active">
                    <div class="panel-body">
                        <div class="">
                            <table cellspacing="0" cellpadding="0" class="table table-striped table-hover" id="myTable"
                                   data-page-size="1" data-filter=#filter>
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>会员卡号</th>
                                    <th>会员等级</th>
                                    <th>姓名</th>
                                    <th>会员电话</th>
                                    <th>会员生日</th>
                                    <th>账户积分</th>
                                    <th>账户余额</th>
                                    <th>办卡时间</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <{foreach $items as $item}>
                                <tr>
                                    <td><label><input type="checkbox" value="<{$item.card_id}>" id="card_id" class="i-checks" name="card_ids[]" CK="PRI"/><{$item.card_id}></label></td>
                                    <td><{$item.number}></td>
                                    <td><{$item['grade_obj']['title']}></td>
                                    <td><{$item.name}></td>
                                    <td><{$item.mobile}></td>
                                    <td>
                                        <{if $item.Y}><{$item.Y}><{else}>---<{/if}>年
                                        <{if $item.M}><{$item.M}><{else}>---<{/if}>月
                                        <{if $item.D}><{$item.D}><{else}>---<{/if}>日
                                    </td>
                                    <td><{$item.jifen}></td>
                                    <td><{$item.money}></td>
                                    <td><{$item.dateline|format:'Y-m-d H:i'}></td>
                                    <td>
                                        <a href="<{link ctl='merchant/shop/expense:index' args=$item.card_id}>" class="btn btn-primary btn-sm btn-outline">消费记录</a>
                                        <a href="<{link ctl='merchant/shop/jifen:index' args=$item.card_id}>" class="btn btn-primary btn-sm btn-outline">积分记录</a>
                                        <a href="<{link ctl='merchant/shop/card:edit' args=$item.card_id}>" class="btn btn-primary btn-sm btn-outline">修改</a>
                                        <a href="<{link ctl='merchant/shop/card:delete' args=$item.card_id}>" 
                                            mini-act="del" mini-confirm="确定要删除吗？" title="删除" class="btn btn-danger btn-sm btn-outline">删除</a>
                                    </td>
                                </tr>
                                <{foreachelse}>
                                <tr>
                                    <td colspan="20">
                                        <div class="alert alert-info"><{L('没有数据')}></div>
                                    </td>
                                </tr>
                                <{/foreach}>
                                </tbody>
                            </table>
                            <!--分页-->
                            <div class="clearfix p-xs">
                                <div class="pull-left">
                                    <label style="margin-right:20px;"><input type="checkbox" id="allChk" cka="PRI">&nbsp;&nbsp;全选</label>
                                    <a href="javascript:delModal();">
                                        <button type="button" class="btn btn-primary" id="delAll">批量删除</button>
                                    </a>
                                </div>
                                <div class="btn-group pull-right pagination_box">
                                    <div class="page"><{$pager.pagebar}></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>
</div>
<{include file="merchant:block/footer.html"}>

<script>
    // 全选  
    $("#allChk").click(function () {
        $("input[name='card_ids[]']").prop("checked", this.checked);
    });

    // 单选  
    var subChk = $("input[name='card_ids[]']")
    subChk.click(function () {
        $("#allChk").prop("checked", subChk.length == subChk.filter(":checked").length ? true : false);
    });

    /* 批量删除 */
    function delAll() {
        var checkedNum = $("input[name='card_ids[]']:checked").length;
        if (checkedNum == 0) {
            layer.msg("请选择至少一项！");
            return;
        }
        // 批量选择   
        if (true) {
            var checkedList = new Array();
            $("input[name='card_ids[]']:checked").each(function () {
                checkedList.push($(this).val());
            });
            $.ajax({
                type: "POST",
                url: "?shop/card/delAll",
                data: {'card_ids': checkedList},
                success: function (ret) {
                    var ret = jQuery.parseJSON(ret);
                    if (ret.error == 0) {
                        layer.msg(ret.message);
                    } else {
                        layer.msg(ret.message);
                    }
                    window.location.reload();
                }
            });
        }
    }
</script>
<script>
    function delModal() {
        swal({
            title: "确定吗?",
            text: "",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "确定",
            cancelButtonText: "取消",
            closeOnConfirm: true, //点击了确认按钮后模态窗口自动关闭
        }, function (isConfirm) {
            if (isConfirm) {
                delAll();
            } else {
                swal("Cancelled", "Your imaginary file is safe :)", "error");
            }
        });
    }
</script>  